<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SRT Bank - Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f0f4f8; font-family: Arial, sans-serif; }
        .navbar { background-color: #004080; }
        .navbar-brand, .nav-link { color: white !important; font-weight: 600; }
        .dashboard-header { margin-top: 30px; text-align: center; }
        .dashboard-header h2 { font-weight: bold; color: #004080; }
        .card-option { cursor: pointer; transition: transform 0.2s ease; border-radius: 12px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card-option:hover { transform: scale(1.05); box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
        #content-section { margin-top: 30px; padding: 20px; text-align: center; background-color: transparent; border: none; box-shadow: none;}
        #chatbox { position: fixed; bottom: 20px; right: 20px; width: 320px; height: 420px; border: 1px solid #ccc; background: white; display: none; flex-direction: column; box-shadow: 0 4px 8px rgba(0,0,0,0.2); border-radius: 10px; z-index: 1000; }
        #chat-header { background: #004080; color: white; padding: 10px; font-weight: bold; border-radius: 10px 10px 0 0; }
        #chat-messages { flex: 1; padding: 10px; overflow-y: auto; font-size: 14px; }
        #chat-input { display: flex; border-top: 1px solid #e0e0e0;}
        #chat-input input { flex: 1; padding: 10px; border: none; outline: none; }
        #chat-input button { border: none; background: #004080; color: white; padding: 10px 15px; cursor: pointer; }
        
        /* This is the style for the intent label */
        .intent-label {
            display: block;
            margin-top: 8px;
            font-size: 12px;
            color: #28a745; /* Green color like the image */
            font-style: italic;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">üè¶ SRT Bank</a>
            <div class="ms-auto"><a href="/logout" class="btn btn-danger">Logout</a></div>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard-header">
            <h2>Welcome, {{ user }}</h2>
            <p class="text-muted">Your personalized banking dashboard</p>
        </div>

        <div class="row mt-4 justify-content-center">
            <div class="col-md-3 mb-4"><div class="card card-option text-center p-3" onclick="window.location.href='/balance';"><h5>üí∞ Balance</h5><p>Check your account balance</p></div></div>
            <div class="col-md-3 mb-4"><div class="card card-option text-center p-3" onclick="window.location.href='/loans';"><h5>üè¶ Loans</h5><p>View loan details</p></div></div>
            <div class="col-md-3 mb-4"><div class="card card-option text-center p-3" onclick="window.location.href='/cards';"><h5>üí≥ Cards</h5><p>Manage your debit/credit cards</p></div></div>
            <div class="col-md-3 mb-4"><div class="card card-option text-center p-3" onclick="window.location.href='/transactions';"><h5>üìà Transactions</h5><p>View your recent transactions</p></div></div>
            <div class="col-md-3 mb-4"><div class="card card-option text-center p-3" onclick="toggleChat()"><h5>ü§ñ Chatbot</h5><p>Get instant help</p></div></div>
        </div>

        <div id="content-section">
            <h4>‚ÑπÔ∏è Welcome! Click an option above to go to the respective page or use the chatbot for instant help.</h4>
        </div>
    </div>

    <div id="chatbox">
        <div id="chat-header">BankBot AI <button onclick="toggleChat()" style="float:right; border:none; background:transparent; color:white;">‚úñ</button></div>
        <div id="chat-messages"><div class="mb-2"><b>Bot:</b> Hello! How can I assist you?</div></div>
        <div id="chat-input"><input type="text" id="userInput" placeholder="Type your message..."><button id="sendBtn">Send</button></div>
    </div>

    <script>
        // This function shows and hides the chatbot window when the "Chatbot" card is clicked.
        function toggleChat() {
            const chatbox = document.getElementById("chatbox");
            if (chatbox.style.display === "flex") {
                chatbox.style.display = "none";
            } else {
                chatbox.style.display = "flex";
            }
        }

        // This is the main function that handles sending messages to the AI.
        async function sendMessage() {
            const input = document.getElementById("userInput");
            const message = input.value.trim();
            if (!message) return; // Don't send empty messages

            const chatMessages = document.getElementById("chat-messages");
            // Immediately display the user's message for a responsive feel.
            chatMessages.innerHTML += `<div class="mb-2 text-end"><b>You:</b> ${message}</div>`;
            input.value = ""; // Clear the input box

            // Send the user's message to our Python backend API.
            const response = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: message })
            });
            
            // Get the response data (reply and intent) from the backend.
            const data = await response.json();
            
            // Create the bot message HTML.
            let botHtml = `<div class="mb-2"><b>Bot:</b> ${data.reply}`;
            
            // If the server sent an intent, add the special green label.
            if (data.intent && data.intent !== "slot_filling" && data.intent !== "error" && data.intent !== "n/a") {
                botHtml += `<span class="intent-label">‚úì ${data.intent}</span>`;
            } else if (data.intent === "out_of_scope") {
                 botHtml += `<span class="intent-label" style="color: #6c757d;">‚óè Chitchat Response</span>`;
            }
            botHtml += `</div>`;
            
            // Add the final HTML to the chat window and scroll to the bottom.
            chatMessages.innerHTML += botHtml;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // These lines make the "Send" button and the "Enter" key work.
        document.getElementById("sendBtn").addEventListener("click", sendMessage);
        document.getElementById("userInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") { sendMessage(); }
        });
    </script>
</body>
</html>